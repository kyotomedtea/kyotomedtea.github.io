<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="http://code.jquery.com/jquery-latest.js" type="text/javascript"></script>
</head>
<body>
    <form>
      <label for="img1">画像ファイル1</label>
      <input type="file" name="img1" id="img1" accept="image/*" /> <!--multiple="multiple"-->
      <label for="name1">名称1</label>
      <input type="text" name="name1" id="name1" />
    </form>
    <button onclick="postJump()" id="sendButton">送信</button>
<div id="xxx"></div>

<script type="text/javascript">
var url = "https://script.google.com/macros/s/AKfycbyjXhlZAIF9zp-K4DenhtWlVlAjKVEmm0K8fMwpFbwGXswFLw/exec";
var params = {};
$("#img1").on("change", function() {
    var file1 = this.files[0];
    var fr1 = new FileReader();
    fr1.onload = function(e) {
        params.img1File = e.target.result.replace(/^.*,/, '');
        params.img1FileName = file1.name;
    }
    fr1.readAsDataURL(file1);
});

function postJump(){
    var html = "<form method = \"post\" action = \"" + url + "\" id = \"postjump\" style = \"display: none;\">";
    Object.keys(params).forEach(function (key) {
        html += "<input type = \"hidden\" name = \"" + key + "\" value = \"" + params[key] + "\">";
    });
    html += "</form>";
    console.log(html);
    $("body").append(html);
    $("#postjump").submit(function(event){ //フォーム送信時
      console.log('posjump was submitted.');
      event.preventDefault(); //HTMLでの送信をキャンセル
      var $form = $(this); //実際に送るフォームを取得
      var $button = $('#sendButton'); //送信ボタンを取得
      $.ajax({ //ajaxで送信
        url: $form.attr('action'),
        type: $form.attr('method'),
        data: $form.serialize(),
        timeout: 10000,  //単位はms

        beforeSend: function(xhr, settings){ //送信前
            $button.attr('disabled', true); //ボタンを無効化して二重送信を防止
        },
        complete: function(xhr, textStatus){ //postのリクエスト返ってきたら
            $button.attr('disabled', false); //ボタンを有効化して再送信を許可
        },
        success: function(result, textStatus, xhr){ //通信成功時の処理
            $form[0].reset(); //入力値を初期化
            alert('OK');
        },
        error: function(xhr, textStatus, error){ //通信失敗時の処理
            alert('NG...');
        }
      });
    });
    $("#postjump").remove();
}

function JSONP(json){
  alert(json);
  (function(){
    location.href = "./upload.html";
  }());
}

// var dataUrl;
// var objFile = document.getElementById("img1");
// objFile.addEventListener("change", function(evt) {
//     var file = evt.target.files;
//     var reader = new FileReader();
//     reader.readAsDataURL(file[0]);
//
//     //ファイルの読み込みが終わったら
//     reader.onload = function() {
//         dataUrl = reader.result;
//         document.getElementById("xxx").innerHTML="<img src='"+dataUrl+"' alt='none'>";
//     };
// }, false);



</script>
</body>
</html>
